<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D√©tail Recette</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="notification" role="alert" aria-live="polite"></div>

  <header>
    <div class="header-inner">
      <h1>D√©tail de la recette</h1>
      <a href="index.html" class="back-btn">‚Üê Retour</a>

      <div class="controls">
        <!-- Recherche -->
        <div class="search-bar-container">
          <div class="search-wrapper">
            <input type="text" id="search-title" placeholder="Rechercher par titre...">
            <button id="clear-title" class="clear-btn"></button>
          </div>
          <div class="search-wrapper">
            <input type="text" id="search-ingredient" placeholder="Rechercher par ingr√©dient...">
            <button id="clear-ingredient" class="clear-btn"></button>
          </div>
        </div>

        <!-- Filtres sp√©ciaux -->
        <div id="special-filters">
          <button id="filter-favorite">‚òÖ Favoris</button>
          <button class="combi-filter" data-filter="gluten">Gluten free</button>
          <button class="combi-filter" data-filter="vege">V√©g√©</button>
          <button class="combi-filter" data-filter="grogros">Grogros</button>
        </div>

        <!-- Tri -->
        <div id="sort-controls">
          <button class="sort-btn" data-sort="asc">A-Z</button>
          <button class="sort-btn" data-sort="desc">Z-A</button>
          <button class="sort-btn" data-sort="newest">Plus r√©centes</button>
          <button class="sort-btn" data-sort="oldest">Plus anciennes</button>
        </div>

        <!-- Cat√©gories -->
        <div id="filters">
          <button data-category="all" class="active">Toutes</button>
          <button data-category="Plat">Plat</button>
          <button data-category="Entr√©e">Entr√©e</button>
          <button data-category="Dessert">Dessert</button>
          <button data-category="Snack">Snack</button>
          <button data-category="Cocktail">Cocktail</button>
        </div>
      </div>
    </div>
  </header>

  <main id="recipe-detail">
    <h2 id="recipe-title"></h2>
    <img id="recipe-image" alt="" style="max-width: 400px; display: block; margin-bottom: 15px;">
    <p><strong>Cat√©gorie :</strong> <span id="recipe-category"></span></p>
    <p><strong>Temps :</strong> <span id="recipe-time"></span></p>
    <h3>Ingr√©dients :</h3>
    <ul id="recipe-ingredients"></ul>
    <h3>Description :</h3>
    <p id="recipe-description"></p>

    <div style="margin-top: 20px;">
      <button id="toggle-favorite">‚≠ê Ajouter/Retirer des favoris</button>
      <button id="delete-recipe" style="background:#f44336; color:white;">üóë Supprimer</button>
    </div>
  </main>

  <script>
    const API_URL = "https://mon-site-recette-backend.onrender.com/recipes";
    const urlParams = new URLSearchParams(window.location.search);
    const recipeId = urlParams.get("id");

    const titleEl = document.getElementById("recipe-title");
    const imgEl = document.getElementById("recipe-image");
    const categoryEl = document.getElementById("recipe-category");
    const timeEl = document.getElementById("recipe-time");
    const ingredientsEl = document.getElementById("recipe-ingredients");
    const descEl = document.getElementById("recipe-description");

    async function loadRecipe() {
      try {
        const res = await fetch(`${API_URL}/${recipeId}`);
        if (!res.ok) throw new Error("Recette non trouv√©e");
        const recipe = await res.json();
        titleEl.textContent = recipe.title;
        categoryEl.textContent = recipe.category;
        timeEl.textContent = recipe.time;
        descEl.textContent = recipe.description;
        ingredientsEl.innerHTML = recipe.ingredients.map(i => `<li>${i}</li>`).join("");
        if (recipe.image) {
          imgEl.src = recipe.image;
          imgEl.style.display = "block";
        } else {
          imgEl.style.display = "none";
        }
      } catch (err) {
        console.error(err);
        titleEl.textContent = "Erreur : recette introuvable.";
      }
    }

    // Toggle favoris
    document.getElementById("toggle-favorite").addEventListener("click", async () => {
      try {
        const res = await fetch(`${API_URL}/${recipeId}/favorite`, { method: "PUT" });
        if (!res.ok) throw new Error("Erreur mise √† jour favoris");
        alert("Statut favoris mis √† jour !");
      } catch (err) {
        console.error(err);
        alert("Erreur lors de la mise √† jour du favori.");
      }
    });

    // Suppression recette
    document.getElementById("delete-recipe").addEventListener("click", async () => {
      if (!confirm("Voulez-vous vraiment supprimer cette recette ?")) return;
      try {
        const res = await fetch(`${API_URL}/${recipeId}`, { method: "DELETE" });
        if (!res.ok) throw new Error("Erreur suppression");
        alert("Recette supprim√©e !");
        window.location.href = "index.html";
      } catch (err) {
        console.error(err);
        alert("Erreur lors de la suppression.");
      }
    });

    loadRecipe();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Détails de la recette</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="notification" role="alert" aria-live="polite"></div>

<div class="detail-page" id="detail-page">
  <button id="back-btn">← Retour</button>
  <span id="favorite-icon" class="favorite-icon">★</span>
  <h2 id="recipe-title"></h2>
  <img id="recipe-image" src="" alt="Image recette">
  <p><strong>Catégorie :</strong> <span id="recipe-category"></span></p>
  <p><strong>Temps :</strong> <span id="recipe-time"></span></p>

  <h3>Ingrédients :</h3>
  <ul id="recipe-ingredients"></ul>

  <h3>Description :</h3>
  <p id="recipe-description"></p>

  <h3>Filtres :</h3>
  <p id="recipe-filters"></p>

  <div class="actions">
    <button id="edit-btn">Éditer</button>
    <button id="delete-btn">Supprimer</button>
  </div>
</div>

<script>
const API_URL = "https://mon-site-recette-backend.onrender.com/recipes";
const params = new URLSearchParams(window.location.search);
const recipeId = params.get("id");

const backBtn = document.getElementById("back-btn");
const favoriteIcon = document.getElementById("favorite-icon");
const titleEl = document.getElementById("recipe-title");
const imageEl = document.getElementById("recipe-image");
const categoryEl = document.getElementById("recipe-category");
const timeEl = document.getElementById("recipe-time");
const ingredientsEl = document.getElementById("recipe-ingredients");
const descriptionEl = document.getElementById("recipe-description");
const filtersEl = document.getElementById("recipe-filters");

const editBtn = document.getElementById("edit-btn");
const deleteBtn = document.getElementById("delete-btn");
const notif = document.getElementById("notification");

function showNotification(message, type="success"){
  notif.textContent = message;
  notif.className = "";
  notif.classList.add("show", type);
  setTimeout(()=>notif.classList.remove("show"),3000);
}

async function fetchRecipe(){
  try{
    const res = await fetch(`${API_URL}/${recipeId}`);
    if(!res.ok) throw new Error("Recette non trouvée");
    const recipe = await res.json();

    titleEl.textContent = recipe.title;
    categoryEl.textContent = recipe.category;
    timeEl.textContent = recipe.time;
    imageEl.src = recipe.image || "";
    imageEl.alt = `Image de ${recipe.title}`;
    descriptionEl.textContent = recipe.description;

    ingredientsEl.innerHTML = recipe.ingredients.map(i=>`<li>${i}</li>`).join("");

    const activeFilters = [];
    if(recipe.favorite) activeFilters.push("Favori");
    if(recipe.glutenFree) activeFilters.push("Gluten Free");
    if(recipe.vege) activeFilters.push("Végé");
    if(recipe.grogros) activeFilters.push("Grogros");
    filtersEl.textContent = activeFilters.join(", ") || "Aucun";

    favoriteIcon.classList.toggle("active", recipe.favorite);

    // Toggle favori
    favoriteIcon.addEventListener("click", async ()=>{
      try{
        await fetch(`${API_URL}/${recipe._id}/favorite`,{method:"PUT"});
        favoriteIcon.classList.toggle("active");
        showNotification("Favori mis à jour !");
      } catch(err){ console.error(err); showNotification("Erreur","error"); }
    });

    // Edit & delete
    editBtn.addEventListener("click", ()=> alert("Édition non implémentée"));
    deleteBtn.addEventListener("click", async ()=>{
      if(confirm("Supprimer cette recette ?")){
        try{
          await fetch(`${API_URL}/${recipe._id}`,{method:"DELETE"});
          showNotification("Recette supprimée");
          setTimeout(()=>window.location.href="index.html",1000);
        } catch(err){ console.error(err); showNotification("Erreur","error"); }
      }
    });

  } catch(err){ console.error(err); showNotification(err.message,"error"); }
}

backBtn.addEventListener("click", ()=> window.history.back());

fetchRecipe();
</script>

</body>
</html>
